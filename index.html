<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTML to WebGL</title>
</head>
<body>

  <div id="app">
    <header id="site-header">
      <h1 id="site-title">Render HTML as a WebGL Texture demo</h1>
      <div id="site-subtitle">
        Demo by <a href="https://github.com/gnikoloff">Georgi Nikolov</a>
        &nbsp;&nbsp;Code on <a href="https://github.com/gnikoloff/html-to-webgl-demo">Github</a>
      </div>
    </header>
    
    <div class="steps-wrapper">
      <div data-name="html-input" class="render-step-slot">
        <h2>01. Input HTML</h2>
        <div class="step-render-wrapper">
          <div class="step-render">
            <div id="html-to-render">
              <!-- <h1>hello</h1> -->
              <div style="
                position: relative;
                font-family: Arial, Helvetica, sans-serif;
                /* max-width: 100%; */
                /* border: 5px solid blue; */
                padding: 20px 30px 20px 20px;
                display: flex;
                justify-content: space-between;
              ">
                <div>
                  <div
                    style="
                      min-width: 62px;
                      width: 62px;
                      height: 62px;
                      background: blue;
                      border-radius: 50%;
                      overflow: hidden;
                      margin-right: 12px;
                      display: inline-block;
                      border: 2px solid blue;
                    "
                  >
                    <img
                      style="object-fit: cover; width: 100%; height: 100%;"
                      src="/resources/person-1.jpg"
                    ></img>
                  </div>
                  <div
                    style="
                      min-width: 62px;
                      width: 62px;
                      height: 62px;
                      background: blue;
                      border-radius: 50%;
                      overflow: hidden;
                      margin-right: 12px;
                      display: inline-block;
                      border: 2px solid blue;
                    "
                  >
                    <img
                      style="object-fit: cover; width: 100%; height: 100%;"
                      src="/resources/person-2.jpg"
                    ></img>
                  </div>
                  <div
                    style="
                      min-width: 62px;
                      width: 62px;
                      height: 62px;
                      background: blue;
                      border-radius: 50%;
                      overflow: hidden;
                      margin-right: 12px;
                      display: inline-block;
                      border: 2px solid blue;
                    "
                  >
                    <img
                      style="object-fit: cover; width: 100%; height: 100%;"
                      src="/resources/person-3.jpg"
                    ></img>
                  </div>
                  <div
                    style="
                      position: relative;
                      min-width: 62px;
                      width: 62px;
                      height: 62px;
                      background: blue;
                      border-radius: 50%;
                      overflow: hidden;
                      margin-right: 12px;
                      display: inline-flex;
                      align-items: center;
                      justify-content: center;
                      color: white;
                      border: 4px solid blue;
                    "
                  >
                    <div
                      style="
                        position: absolute;
                        top: 0;
                        right: 0;
                        bottom: 0;
                        left: 0;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-size: 24px;
                      "
                    >
                      +
                    </div>
                  </div>
                  <div
                    style="position: relative;"
                  >
                    <div
                      style="
                        width: 20px;
                        height: 24px;
                        background: blue;
                        position: absolute;
                        bottom: 20px;
                        right: -6px;
                        transform: skewX(-45deg) rotate(2deg);
                        z-index: -1;
                      "
                    ></div>
                    <h1
                      style="
                        color: rgba(85, 85, 85, 0.9);
                      "
                    >
                      Inbox (1)
                    </h1>
                    <p
                      style="
                        background: blue;
                        color: white;
                        padding: 8px 12px;
                        box-sizing: border-box;
                        border-radius: 8px;
                        font-size: 0.9rem;
                        line-height: 1.5rem;
                        letter-spacing: 0.025rem;
                      "
                    >
                      
                      Lorem ipsum dolor sit amet <i>consectetur adipisicing</i> elit. Deleniti laborum error tempore nulla consequuntur  ğŸ‘» ğŸ’€ â˜ ï¸ ğŸ‘½ ğŸ‘¾ ğŸ¤–  blanditiis labore natus ratione eius, placeat omnis quas <strong>adipisci architecto</strong> harum accusamus reprehenderit, repellendus ullam. Culpa!
                      ğŸ˜ŠğŸ¥ºğŸ˜‰ğŸ˜ğŸ˜˜ğŸ˜šğŸ˜œğŸ˜‚ğŸ˜ğŸ˜³ğŸ˜ğŸ˜£ğŸ˜¢ğŸ˜­ğŸ˜°ğŸ¥°
                      </div>
                    </p>
                  </div>
                </div>
  
                
            </div>
          </div>
        </div>
      </div>
      <div data-name="svg-render" class="render-step-slot">
        <h2>02. Insert HTML fragment in SVG foreignObject</h2>
        <div class="step-render-wrapper">
          <div class="step-render"></div>
        </div>
      </div>
  
      <div data-name="canvas-render" class="render-step-slot">
        <h2>03. Draw SVG result to canvas2D as a regular img</h2>
        <div class="step-render-wrapper">
          <div class="step-render"></div>
        </div>
      </div>
  
      <div data-name="webgl-render" class="render-step-slot">
        <h2>04. Draw canvas2d result as WebGL texture on a quad</h2>
        <div class="step-render-wrapper">
          <div class="step-render"></div>
        </div>
      </div>
    </div>

    <div id="intro">
      <p>
        <h2>Purposes of this demo</h2>
        <p>Why would one want to render HTML using WebGL? Besides flashy effects and per-pixel manipulations possible by writing shaders, this method is useful where performance and responsiveness are UI critical.</p>
        <p>If we are to build UI that required a stack of layered cards (as in Tinder), which can be fluidly moved by touch and faded out, layouting, compositing and capturing dragging events at the same time can be pretty costly.</p>
        <img style="max-width: 600px; margin: 0 auto; display: block;" src="/resources/blended-example.png" alt="Illustration of a three positioned on top of each other and blended generic UI elements" />
        <p>Compositing large elements with a lot of children which may have have their own opacities / shadowes, all while capturing touch events can get real bad real soon</p>
        <br/><br/>
        <p>What if we could create a WebGL context, and render each card as a simple quad with a texture of it's corresponding UI, instead of trying to render complex tree structure such as the DOM? Our rendering will be offloaded to the GPU, resulting in a massive performance boost and per-pixel control over its graphics using shaders.</p>
        <p>This technique works nicely with React and more specifically <code>ReactDOMServer.renderToString()</code>. It can be offloaded to web-workers for string concatenation and offscreen canvas for rendering.</p>
        <p>This demo uses <a href="https://twgljs.org/" target="_blank">TWGL.js</a> for rendering the texture to WebGL. Inspired by <a href="https://medium.com/@VilledieuMorgan/mountaindew-x-titanfall-technical-review-35f1be4089c">this</a> and .</p>
        <br/><br/>
        <h2>It all starts with our input HTML</h2>
        <p>We will insert our specially formated HTML into SVG <code>&lt;foreignObject&gt;</code> special tag. It uses the built-in browser rendering pipeline to display HTML as part of a SVG graphic. We will then draw the SVG as a regular image onto a canvas2d element, which in turn we will use as a source to webgl texture.</p>
        <h3>Restrictions of this technique</h3>
        <p>There are some restrictions to what kind of HTML is allowed though:
          <ol>
            <li>
              No external assets, such as images, fonts, styles etc are allowed. If we want to display an image or use a special font, we need to download it first, encode it into base64 and then supply it to the<code>&lt;foreignObject&gt;</code>.
              <br/>
              This can quickly cause massively big strings to work with.
            </li>
            <li>
              We have to inline all of our styles and be careful to prevent any styling inheritance on the element we want to render and its children.
              <br />
              <br />
              That's because even though our HTML and SVG can inherit the host page stylesheets, once we pass them to the canvas for drawing, these inherited styles will be stripped and not applied.
              <br />
              (If you inspect this demo page itself, you will see how specific I am with my css selectors. I do not apply any global style to specific tags to prevent non-transfered styles once I rendert to canvas)
              <br />
              <br />
              We can either:
              <br />
              <br />
              <ol>
                <li>
                  Inline all of our styles directly on the HTML to be drawn (this is what I do in this demo, you can inspect step 1 contents):
          <code class="code language-html">
            &lt;div style="
              position: relative;
              font-family: Arial, Helvetica, sans-serif;
              max-width: 400px;
              padding: 20px 30px 20px 20px;
              display: flex;
              justify-content: space-between;
            "&gt;
            ...
            &lt;/div&gt;
                            </code>
                </li>
                
                <li>Compute the styles that affect each child in our HTML using <code>getComputedStyle()</code> and append the result to an inline tag. This can be a huge performance bottleneck and will result in giant strings too (you have to apply <strong>every</strong> possible style that affect this element to make sure it renders correctly)</li>
              </ol>
            </li>
            <li>Since our final result is a bitmap graphic rendered in WebGL, we will obviously lose real selectable text, any SEO and any kind of mouse, keyboard, etc events. We would need to supply our own logic to decide on which element we are, in fact, hovering or clicking.</li>
          </ol>
          <br/>
          <h3>But it's not all that bad</h3>
          <p>Besides these deal-breakers, it seems browser vendors did not write a custom rendering path for the &lt;foreignObject&gt; and everything else appears to be fair game. Flexbox, various elements, fancy CSS transforms and even other SVGs can all be embeded and render just fine.</p>
        </p>
        <br/>
        <br/>
        <br/>
      </p>
    </div>
  </div>

  <script src="./app/index.js"></script>
</body>
</html>